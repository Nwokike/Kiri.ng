{% extends "core/base.html" %}
{% load i18n academy_extras %}

{# SEO blocks from the original public template are kept for public visibility #}
{% block title %}{{ pathway.goal }} - Learn at Kiri.ng Academy{% endblock %}
{% block description %}Explore this learning pathway: {{ pathway.goal }}. Join Kiri.ng Academy to access AI-powered learning modules, video tutorials, and practical skills training.{% endblock %}
{% block og_url %}https://kiri.ng{{ pathway.get_public_url }}{% endblock %}
{% block og_title %}{{ pathway.goal }} - Kiri.ng Academy{% endblock %}
{% block og_description %}AI-powered learning pathway created by {{ pathway.user.username }}. Master {{ pathway.goal|lower }} with structured modules and video tutorials at Kiri.ng Academy.{% endblock %}
{% block canonical_url %}https://kiri.ng{{ pathway.get_public_url }}{% endblock %}


{% block content %}
<div class="row">
    {# Using the wider col-lg-10 from the main template for a consistent look #}
    <div class="col-lg-10 mx-auto">
        <div class="mb-4">
            {# Using the h1 from the public template for better SEO #}
            <h1 class="fw-bold">{{ pathway.goal }}</h1>
            <p class="lead text-muted">
                {% blocktrans with username=pathway.user.username %}
                A learning pathway created by {{ username }}.
                {% endblocktrans %}
            </p>
            <p class="mt-3">
                <a href="{% url 'users:signup' %}" class="btn btn-primary">
                    <i class="bi bi-rocket-takeoff-fill"></i> {% trans "Create Your Own AI Pathway - Sign Up Free!" %}
                </a>
            </p>
        </div>

        <hr class="my-4">

        {# This accordion structure is copied directly from your main template #}
        <div class="accordion" id="pathwayAccordion">
            {% for module in pathway.modules.all %}
                <div class="accordion-item mb-2">
                    {# 
                        Simplified accordion header for public view.
                        - We check if it's the first module in the loop (forloop.first).
                        - If it is, the button is not 'collapsed' and the body will have the 'show' class to be open by default.
                        - Otherwise, it's collapsed.
                    #}
                    <h2 class="accordion-header">
                        <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ module.id }}">
                            ðŸ“– {% trans "Module" %} {{ module.order|add:1 }}: {{ module.title }}
                        </button>
                    </h2>
                    <div id="collapse{{ module.id }}" class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" data-bs-parent="#pathwayAccordion">
                        <div class="accordion-body">
                            
                            {# Replicating the nice video card layout from the main template #}
                            {% if module.videos.all %}
                                <div class="mb-4">
                                    <h5 class="mb-3"><i class="bi bi-play-circle-fill text-primary"></i> {% trans "Video Tutorials" %}</h5>
                                    <div class="row">
                                        {% for video in module.videos.all %}
                                        <div class="col-md-6 mb-3">
                                            <div class="card h-100">
                                                <div class="ratio ratio-16x9">
                                                    {# Using the embed URL filter for consistency #}
                                                    <iframe src="https://www.youtube.com/embed/{{ video.video_url|get_yt_id }}" title="{{ video.title }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                                </div>
                                                <div class="card-body">
                                                    <h6 class="card-title">{{ forloop.counter }}. {{ video.title }}</h6>
                                                    {% if video.description %}<p class="card-text text-muted small">{{ video.description }}</p>{% endif %}
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endif %}
                            
                            {# Displaying the written lesson with the same styling as the main template #}
                            <div class="mb-4">
                                <h5 class="mb-3"><i class="bi bi-book-fill text-success"></i> {% trans "Written Lesson" %}</h5>
                                <div class="p-3 rounded markdown-content" style="background-color: var(--light-card); border: 1px solid var(--light-border);">
                                    {{ module.written_content|markdownify|safe }}
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>
            {% empty %}
                {# Fallback message if no modules exist #}
                <div class="alert alert-info">
                    {% trans "The modules for this pathway are still being generated. Check back soon!" %}
                </div>
            {% endfor %}
        </div>
        
        {# Keeping the final call-to-action block from the original public template #}
        <div class="alert alert-success mt-5 text-center">
            <h4 class="alert-heading">ðŸš€ {% trans "Ready to Start Your Own Learning Journey?" %}</h4>
            <p>{% trans "Sign up for Kiri.ng to get AI-powered personalized learning paths, track your progress, and earn certificates!" %}</p>
            <hr>
            <a href="{% url 'users:signup' %}" class="btn btn-primary btn-lg">{% trans "Get Started for Free" %}</a>
        </div>
    </div>
</div>
{% endblock %}
